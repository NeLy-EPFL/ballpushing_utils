---
# Configuration file for F1 tracks analysis scripts
# This file consolidates common parameters across different analysis modes

# Analysis modes configuration
analysis_modes:
  control:
    description: "Control flies tested across pretraining and F1 conditions"
    dataset_path: "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251013_17_summary_F1_New_Data/summary/pooled_summary.feather"
    fly_positions_path: "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251121_17_summary_F1_New_Data/fly_positions/pooled_fly_positions.feather"
    grouping_variables:
      primary: "pretraining"  # Column name will be auto-detected with "pretrain" in name
      secondary: "f1_condition"  # Column name will be auto-detected with "f1" and "condition"
    excluded_dates: ["250904"]  # Dates to exclude from analysis
    # Coordinate plotting specific settings
    coordinates:
      coordinates_path: "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251014_10_F1_coordinates_F1_New_Data/F1_coordinates/pooled_F1_coordinates.feather"
      summary_path: "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251013_17_summary_F1_New_Data/summary/pooled_summary.feather"
      alternative_coordinates_paths:
        - "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251014_F1_coordinates_F1_New_Data/F1_coordinates/pooled_F1_coordinates.feather"
        - "/mnt/upramdya_data/MD/F1_Tracks/Datasets/latest_F1_coordinates/pooled_F1_coordinates.feather"
      alternative_summary_paths:
        - "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251013_summary_F1_New_Data/summary/pooled_summary.feather"
        - "/mnt/upramdya_data/MD/F1_Tracks/Datasets/latest_summary/pooled_summary.feather"
      coordinates_plot_params:
        normalize_methods: ["percentage", "trimmed", "adaptive_trimmed"]
        percentage_bin_size: 0.1
        trimmed_time_bin_size: 0.1
        time_window: {start: -10, end: 30}
        create_individual_fly_plots: true  # Set to false to skip individual fly trajectory plots (faster)
        max_individual_lines_per_group: 50  # Cap number of individual fly lines plotted per group

  tnt_mb247:
    description: "TNT MB247 flies tested across pretraining and genotype"
    dataset_path: "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251104_09_F1_coordinates_F1_TNT_MB247_Data/summary/pooled_summary.feather"
    fly_positions_path: "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251124_14_fly_positions_F1_TNT_MB247_Data/fly_positions/pooled_fly_positions.feather"
    grouping_variables:
      primary: "pretraining"  # Column name will be auto-detected with "pretrain" in name
      secondary: "genotype"   # Column name will be auto-detected with "genotype"
    excluded_dates: ["250904"]
    brain_region_mapping:
      "TNTxMB247": "MB"
      "TNTxEmptyGal4": "Control"
      "TNTxEmptySplit": "Control"
    # Coordinate plotting specific settings for MB247
    coordinates:
      coordinates_path: "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251104_09_F1_coordinates_F1_TNT_MB247_Data/F1_coordinates/pooled_F1_coordinates.feather"
      summary_path: "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251104_09_F1_coordinates_F1_TNT_MB247_Data/summary/pooled_summary.feather"
      alternative_coordinates_paths:
        - "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251015_F1_coordinates_F1_TNT_MB247_Data/F1_coordinates/pooled_F1_coordinates.feather"
      alternative_summary_paths:
        - "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251014_summary_F1_TNT_MB247_Data/summary/pooled_summary.feather"
      coordinates_plot_params:
        normalize_methods: ["percentage", "trimmed", "adaptive_trimmed"]
        percentage_bin_size: 0.1
        trimmed_time_bin_size: 0.1
        time_window: {start: -10, end: 30}
        create_individual_fly_plots: true  # Set to false to skip individual fly trajectory plots (faster)
        run_permutation_tests: true
        permutation_params:
          n_permutations: 10000
          alpha: 0.05
          bin_size: 10.0  # 10% bins for permutation tests (0-10, 10-20, ..., 90-100)
          progress: true

  tnt_lc10_2:
    description: "TNT LC10-2 flies tested across pretraining and genotype"
    dataset_path: "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251027_16_F1_coordinates_F1_TNT_LC10-2_Data/summary/pooled_summary.feather"
    fly_positions_path: "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251027_16_F1_coordinates_F1_TNT_LC10-2_Data/fly_positions/pooled_fly_positions.feather"
    grouping_variables:
      primary: "pretraining"  # Column name will be auto-detected with "pretrain" in name
      secondary: "genotype"   # Column name will be auto-detected with "genotype"
    excluded_dates: ["250904"]
    brain_region_mapping:
      "TNTxLC10-2": "Vision"
      "TNTxEmptyGal4": "Control"
      "TNTxEmptySplit": "Control"
    # Coordinate plotting specific settings for LC10-2
    coordinates:
      coordinates_path: "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251027_16_F1_coordinates_F1_TNT_LC10-2_Data/F1_coordinates/pooled_F1_coordinates.feather"
      summary_path: "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251027_16_F1_coordinates_F1_TNT_LC10-2_Data/summary/pooled_summary.feather"
      alternative_coordinates_paths:
        - "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251020_F1_coordinates_F1_TNT_LC10-2_Data/F1_coordinates/pooled_F1_coordinates.feather"
      alternative_summary_paths:
        - "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251020_summary_F1_TNT_LC10-2_Data/summary/pooled_summary.feather"
      coordinates_plot_params:
        normalize_methods: ["percentage", "trimmed", "adaptive_trimmed"]
        percentage_bin_size: 0.1
        trimmed_time_bin_size: 0.1
        time_window: {start: -10, end: 30}
        create_individual_fly_plots: true  # Set to false to skip individual fly trajectory plots (faster)

  tnt_ddc:
    description: "TNT DDC flies tested across pretraining and genotype"
    dataset_path: "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251124_13_F1_coordinates_F1_TNT_DDC_Data/summary/pooled_summary.feather"
    fly_positions_path: "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251124_14_fly_positions_F1_TNT_DDC_Data/fly_positions/pooled_fly_positions.feather"
    grouping_variables:
      primary: "pretraining"  # Column name will be auto-detected with "pretrain" in name
      secondary: "genotype"   # Column name will be auto-detected with "genotype"
    excluded_dates: ["250904"]
    brain_region_mapping:
      "TNTxDDC": "Olfaction"
      "TNTxEmptyGal4": "Control"
    # Coordinate plotting specific settings for DDC
    coordinates:
      coordinates_path: "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251124_13_F1_coordinates_F1_TNT_DDC_Data/F1_coordinates/pooled_F1_coordinates.feather"
      summary_path: "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251124_13_F1_coordinates_F1_TNT_DDC_Data/summary/pooled_summary.feather"
      alternative_coordinates_paths:
        - "/mnt/upramdya_data/MD/F1_Tracks/Datasets/latest_F1_TNT_DDC/F1_coordinates/pooled_F1_coordinates.feather"
      alternative_summary_paths:
        - "/mnt/upramdya_data/MD/F1_Tracks/Datasets/latest_F1_TNT_DDC/summary/pooled_summary.feather"
      coordinates_plot_params:
        normalize_methods: ["percentage", "trimmed", "adaptive_trimmed"]
        percentage_bin_size: 0.1
        trimmed_time_bin_size: 0.1
        time_window: {start: -10, end: 30}
        create_individual_fly_plots: true  # Set to false to skip individual fly trajectory plots (faster)
        run_permutation_tests: true
        permutation_params:
          n_permutations: 10000
          alpha: 0.05
          bin_size: 10.0  # 10% bins for permutation tests (0-10, 10-20, ..., 90-100)
          progress: true

  # Pooled modes - combine data from multiple experiments for shared controls
  tnt_ddc_pooled:
    description: "TNT DDC with pooled EmptyGal4 controls from MB247 and LC10-2"
    primary_dataset: "tnt_ddc"  # Reference to main mode
    pool_from_modes: ["tnt_mb247", "tnt_lc10_2"]  # Pool controls from these modes
    shared_genotypes: ["TNTxEmptyGal4"]  # Genotypes to pool
    grouping_variables:
      primary: "pretraining"
      secondary: "genotype"
    excluded_dates: ["250904"]
    brain_region_mapping:
      "TNTxDDC": "Olfaction"
      "TNTxEmptyGal4": "Control"
    # Coordinate plotting specific settings for DDC pooled
    coordinates:
      coordinates_path: "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251124_13_F1_coordinates_F1_TNT_DDC_Data/F1_coordinates/pooled_F1_coordinates.feather"
      summary_path: "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251124_13_F1_coordinates_F1_TNT_DDC_Data/summary/pooled_summary.feather"
      alternative_coordinates_paths:
        - "/mnt/upramdya_data/MD/F1_Tracks/Datasets/latest_F1_TNT_DDC/F1_coordinates/pooled_F1_coordinates.feather"
      alternative_summary_paths:
        - "/mnt/upramdya_data/MD/F1_Tracks/Datasets/latest_F1_TNT_DDC/summary/pooled_summary.feather"
      coordinates_plot_params:
        normalize_methods: ["percentage", "trimmed", "adaptive_trimmed"]
        percentage_bin_size: 0.1
        trimmed_time_bin_size: 0.1
        time_window: {start: -10, end: 30}
        create_individual_fly_plots: true
        run_permutation_tests: true
        permutation_params:
          n_permutations: 10000
          alpha: 0.05
          bin_size: 10.0
          progress: true

  tnt_mb247_pooled:
    description: "TNT MB247 with pooled EmptyGal4 controls from DDC and LC10-2"
    primary_dataset: "tnt_mb247"
    pool_from_modes: ["tnt_ddc", "tnt_lc10_2"]
    shared_genotypes: ["TNTxEmptyGal4"]
    grouping_variables:
      primary: "pretraining"
      secondary: "genotype"
    excluded_dates: ["250904"]
    brain_region_mapping:
      "TNTxMB247": "MB"
      "TNTxEmptyGal4": "Control"
    # Coordinate plotting specific settings for MB247 pooled
    coordinates:
      coordinates_path: "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251104_09_F1_coordinates_F1_TNT_MB247_Data/F1_coordinates/pooled_F1_coordinates.feather"
      summary_path: "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251104_09_F1_coordinates_F1_TNT_MB247_Data/summary/pooled_summary.feather"
      alternative_coordinates_paths:
        - "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251015_F1_coordinates_F1_TNT_MB247_Data/F1_coordinates/pooled_F1_coordinates.feather"
      alternative_summary_paths:
        - "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251014_summary_F1_TNT_MB247_Data/summary/pooled_summary.feather"
      coordinates_plot_params:
        normalize_methods: ["percentage", "trimmed", "adaptive_trimmed"]
        percentage_bin_size: 0.1
        trimmed_time_bin_size: 0.1
        time_window: {start: -10, end: 30}
        create_individual_fly_plots: true
        run_permutation_tests: true
        permutation_params:
          n_permutations: 10000
          alpha: 0.05
          bin_size: 10.0
          progress: true

  tnt_lc10_2_pooled:
    description: "TNT LC10-2 with pooled EmptyGal4 controls from MB247 and DDC"
    primary_dataset: "tnt_lc10_2"
    pool_from_modes: ["tnt_mb247", "tnt_ddc"]
    shared_genotypes: ["TNTxEmptyGal4", "TNTxEmptySplit"]
    grouping_variables:
      primary: "pretraining"
      secondary: "genotype"
    excluded_dates: ["250904"]
    brain_region_mapping:
      "TNTxLC10-2": "Vision"
      "TNTxEmptyGal4": "Control"
      "TNTxEmptySplit": "Control"
    # Coordinate plotting specific settings for LC10-2 pooled
    coordinates:
      coordinates_path: "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251027_16_F1_coordinates_F1_TNT_LC10-2_Data/F1_coordinates/pooled_F1_coordinates.feather"
      summary_path: "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251027_16_F1_coordinates_F1_TNT_LC10-2_Data/summary/pooled_summary.feather"
      alternative_coordinates_paths:
        - "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251020_F1_coordinates_F1_TNT_LC10-2_Data/F1_coordinates/pooled_F1_coordinates.feather"
      alternative_summary_paths:
        - "/mnt/upramdya_data/MD/F1_Tracks/Datasets/251020_summary_F1_TNT_LC10-2_Data/summary/pooled_summary.feather"
      coordinates_plot_params:
        normalize_methods: ["percentage", "trimmed", "adaptive_trimmed"]
        percentage_bin_size: 0.1
        trimmed_time_bin_size: 0.1
        time_window: {start: -10, end: 30}
        create_individual_fly_plots: true

# Common analysis parameters
analysis_parameters:
  # Ball condition filtering
  ball_condition:
    filter_for_test_ball: true
    test_ball_values: ["test", "Test", "TEST", "1", 1, "test_ball", "testball"]
    ball_condition_columns: ["ball_condition", "ball_identity"]  # Priority order

  # Binary metrics to analyze
  binary_metrics: ["has_finished", "has_long_pauses", "has_major", "has_significant"]

  # Continuous metrics for boxplots
  continuous_metrics:
    # Core base metrics from comprehensive analysis
    base_metrics:
      - "nb_events"
      - "max_event"
      - "max_event_time"
      - "max_distance"
      - "final_event"
      - "final_event_time"
      - "nb_significant_events"
      - "significant_ratio"
      - "first_significant_event"
      - "first_significant_event_time"
      - "first_major_event"
      - "first_major_event_time"
      - "major_event"
      - "major_event_time"
      - "pulled"
      - "pulling_ratio"
      - "interaction_persistence"
      - "distance_moved"
      - "distance_ratio"
      - "chamber_exit_time"
      - "normalized_velocity"
      - "auc"
      - "overall_interaction_rate"
      - "time_to_first_interaction"  # Time until fly first interacts with ball
      - "ball_proximity_proportion"  # Proportion of time spent near ball (requires position data)

    # Pattern-based metric search patterns
    additional_patterns:
      - "velocity"
      - "speed"
      - "pause"
      - "freeze"
      - "persistence"
      - "trend"
      - "interaction_rate"
      - "finished"
      - "chamber"
      - "facing"
      - "flailing"
      - "head"
      - "median_"
      - "mean_"

    # Patterns to exclude from analysis
    excluded_patterns:
      - "binned_"
      - "r2"
      - "slope"
      - "_bin_"
      - "logistic_"

    # Legacy shortcuts for backward compatibility
    interaction_rate: "overall_interaction_rate"
    distance_metrics: ["distance_moved", "max_distance", "distance_ratio"]
    pulling_metrics: ["pulled", "pulling_ratio", "significant_ratio"]

  # Statistical tests
  statistical_tests:
    binary_metrics:
      two_groups: "fisher_exact"
      fallback: "chi_square"
    continuous_metrics:
      two_groups: "mann_whitney"
      multiple_groups: "kruskal_wallis"

# Plot styling configuration
plot_styling:
  control:
    figure_size: [20, 16]
    pretraining_colors:
      "n": "steelblue"
      "y": "orange"
    f1_condition_colors:
      "control": "steelblue"
      "pretrained": "orange"
      "pretrained_unlocked": "lightgreen"
    pretraining_order: ["n", "y"]
    f1_condition_order: ["control", "pretrained_unlocked", "pretrained"]

  tnt_mb247:
    figure_size: [20, 12]
    brain_region_colors:
      "MB": "#1f77b4"  # Blue
      "Control": "#7f7f7f"  # Gray
      "Vision": "#ff7f0e"  # Orange
      "Unknown": "#808080"  # Gray
    pretraining_styles:
      "n": "white_fill_colored_edge"  # White fill with colored outline
      "y": "colored_fill"  # Colored fill

  tnt_lc10_2:
    figure_size: [20, 12]
    brain_region_colors:
      "Vision": "#ff7f0e"  # Orange
      "Control": "#7f7f7f"  # Gray
      "Unknown": "#808080"  # Gray
    pretraining_styles:
      "n": "white_fill_colored_edge"
      "y": "colored_fill"

  tnt_ddc:
    figure_size: [20, 12]
    brain_region_colors:
      "Olfaction": "#8B4513"  # Brown (SaddleBrown)
      "Control": "#7f7f7f"  # Gray
      "Unknown": "#808080"  # Gray
    pretraining_styles:
      "n": "white_fill_colored_edge"
      "y": "colored_fill"

  # Pooled mode styling - inherits from primary mode
  tnt_ddc_pooled:
    figure_size: [20, 12]
    brain_region_colors:
      "Olfaction": "#8B4513"  # Brown
      "Control": "#7f7f7f"  # Gray
      "Unknown": "#808080"  # Gray
    pretraining_styles:
      "n": "white_fill_colored_edge"
      "y": "colored_fill"

  tnt_mb247_pooled:
    figure_size: [20, 12]
    brain_region_colors:
      "MB": "#1f77b4"  # Blue
      "Control": "#7f7f7f"  # Gray
      "Vision": "#ff7f0e"  # Orange
      "Unknown": "#808080"  # Gray
    pretraining_styles:
      "n": "white_fill_colored_edge"
      "y": "colored_fill"

  tnt_lc10_2_pooled:
    figure_size: [20, 12]
    brain_region_colors:
      "Vision": "#ff7f0e"  # Orange
      "Control": "#7f7f7f"  # Gray
      "Unknown": "#808080"  # Gray
    pretraining_styles:
      "n": "white_fill_colored_edge"
      "y": "colored_fill"

# Output configuration
output:
  save_plots: true
  plot_format: "png"
  dpi: 300
  bbox_inches: "tight"
  show_plots: false  # Default to not showing plots (save only). Use --show flag to display.

  # Summary statistics
  print_detailed_stats: true
  save_summary_tables: false  # Option to save CSV summaries

# Column name detection patterns
column_detection:
  pretraining:
    patterns: ["pretrain", "Pretraining"]  # More specific patterns
    case_insensitive: true

  f1_condition:
    patterns: ["F1_condition", "F1condition", "F1 condition", "f1_condition", "f1condition"]  # Avoid matching "fly"
    case_insensitive: false  # Use exact case to avoid false matches

  genotype:
    patterns: ["genotype", "Genotype", "strain"]
    case_insensitive: true

  ball_condition:
    patterns: ["ball_condition", "ball_identity"]  # Removed generic "ball" to avoid matching measurement columns
    priority: ["ball_condition", "ball_identity"]  # Check in this order
    case_insensitive: true

# Brain region integration
brain_region_config:
  use_config_file: true
  config_path: "/home/matthias/ballpushing_utils/src/PCA/Config.py"
  fallback_colors:
    "MB": "#1f77b4"
    "Control": "#7f7f7f"
    "Vision": "#ff7f0e"
    "Unknown": "#808080"

# Advanced options
advanced:
  # Data filtering
  remove_infinite_values: true
  minimum_sample_size: 2  # Minimum n per group for statistical testing

  # Plot customization
  add_sample_sizes: true
  add_statistical_annotations: true
  rotate_x_labels: true  # For long labels

  # Confidence intervals for continuous metrics
  confidence_level: 0.95

  # Jitter settings for scatter plots
  jitter_alpha: 0.7
  jitter_size: 6

# Templates for different plot types
plot_templates:
  binary_metrics:
    layout: "bar_plots_with_heatmap"
    statistical_annotation: true
    show_proportions: true
    show_counts: true

  boxplots:
    overlay_scatter: true
    box_style: "no_fill_black_outline"
    scatter_color: "black"
    add_median_line: true

  coordinate_plots:
    time_normalization: ["percentage", "trimmed"]
    confidence_intervals: true
    bin_size: 0.1  # For percentage-based plots

  correlation_plots:
    scatter_with_regression: true
    color_by_groups: true
    add_correlation_stats: true

# Validation settings
validation:
  check_required_columns: true
  warn_missing_metrics: true
  validate_grouping_variables: true
  check_data_distribution: true